npx : FAIL __tests__/api/team-lead/leave-requests.test.ts
At C:\Users\usama\Dropbox\My PC (Puris)\Downloads\rotacloud-complete\test-teamlead.ps1:7 char:19
+ ... estOutput = npx jest __tests__/api/team-lead/leave-requests.test.ts - ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (FAIL __tests__/...equests.test.ts:String) [], RemoteExcep 
   tion
    + FullyQualifiedErrorId : NativeCommandError
 
  Team Lead Leave Requests API
    GET /api/team-lead/leave-requests
      ├ù should return leave requests for team lead's team (7 ms)
      ├ù should filter by status when provided (1 ms)
      ├ù should filter by leave type when provided (1 ms)
      ΓêÜ should return 403 if user is not a team lead (1 ms)
      ├ù should return 404 if no team found for team lead (1 ms)
    GET /api/team-lead/leave-requests/[id]
      ├ù should return a specific leave request for team lead's team (2 ms)
      ├ù should return 403 if leave request is not for team lead's team (5 ms)
      ├ù should return 404 if leave request not found
    PATCH /api/team-lead/leave-requests/[id]
      ├ù should approve a pending leave request (1 ms)
      ├ù should deny a pending leave request (1 ms)
      ├ù should return 400 if trying to approve/reject non-pending request (1 ms)
      ├ù should return 403 if leave request is not for team lead's team (2 ms)
      ├ù should return 400 for invalid status (1 ms)
      ├ù should handle team lead notes correctly

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should return leave 
requests for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 75 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 76 |[39m
    [31m[1m>[22m[39m[90m 77 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 78 |[39m       expect(data[33m.[39mdata)[33m.[39mtoEqual([mockLeaveRequest])
     [90m 79 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 80 |[39m         expect[33m.[39mstringContaining([32m'WHERE e.team_id = 
$1'[39m)[33m,[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:77:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should filter by status 
when provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 89 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m 
[33mGET[39m(request)
     [90m 90 |[39m
    [31m[1m>[22m[39m[90m 91 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 92 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 93 |[39m         expect[33m.[39mstringContaining([32m'AND lr.status = 
$2'[39m)[33m,[39m
     [90m 94 |[39m         [mockTeam[33m.[39mid[33m,[39m [32m'pending'[39m][0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:91:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should filter by leave 
type when provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 102 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m 
[33mGET[39m(request)
     [90m 103 |[39m
    [31m[1m>[22m[39m[90m 104 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 105 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 106 |[39m         expect[33m.[39mstringContaining([32m'AND lr.type = 
$2'[39m)[33m,[39m
     [90m 107 |[39m         [mockTeam[33m.[39mid[33m,[39m [32m'vacation'[39m][0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:104:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should return 404 if no 
team found for team lead

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 127 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 128 |[39m
    [31m[1m>[22m[39m[90m 129 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 130 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'No team found for this 
team lead'[39m)
     [90m 131 |[39m     })
     [90m 132 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:129:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests/[id] ΓÇ║ should return a 
specific leave request for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 140 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 141 |[39m
    [31m[1m>[22m[39m[90m 142 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 143 |[39m       expect(data[33m.[39mdata)[33m.[39mtoEqual(mockLeaveRequest)
     [90m 144 |[39m     })
     [90m 145 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:142:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests/[id] ΓÇ║ should return 403 if 
leave request is not for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: "Forbidden: Can only access leave requests for team members"
    Received: "Forbidden: Only team leads can access this endpoint"

    [0m [90m 152 |[39m
     [90m 153 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
    [31m[1m>[22m[39m[90m 154 |[39m       
expect(data[33m.[39merror)[33m.[39mtoBe([32m'Forbidden: Can only access leave requests for team 
members'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 155 |[39m     })
     [90m 156 |[39m
     [90m 157 |[39m     it([32m'should return 404 if leave request not found'[39m[33m,[39m 
[36masync[39m () [33m=>[39m {[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:154:26)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests/[id] ΓÇ║ should return 404 if 
leave request not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 162 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 163 |[39m
    [31m[1m>[22m[39m[90m 164 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 165 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Leave request not 
found'[39m)
     [90m 166 |[39m     })
     [90m 167 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:164:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should approve a 
pending leave request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 181 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 182 |[39m
    [31m[1m>[22m[39m[90m 183 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 184 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Leave request approved 
successfully'[39m)
     [90m 185 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 186 |[39m         expect[33m.[39mstringContaining([32m'UPDATE leave_requests SET status 
= $1'[39m)[33m,[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:183:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should deny a 
pending leave request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 202 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 203 |[39m
    [31m[1m>[22m[39m[90m 204 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 205 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Leave request denied 
successfully'[39m)
     [90m 206 |[39m     })
     [90m 207 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:204:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should return 400 
if trying to approve/reject non-pending request

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 217 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 218 |[39m
    [31m[1m>[22m[39m[90m 219 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 220 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Can only approve/reject 
pending requests'[39m)
     [90m 221 |[39m     })
     [90m 222 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:219:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should return 403 
if leave request is not for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: "Forbidden: Can only manage leave requests for team members"
    Received: "Forbidden: Only team leads can access this endpoint"

    [0m [90m 233 |[39m
     [90m 234 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
    [31m[1m>[22m[39m[90m 235 |[39m       
expect(data[33m.[39merror)[33m.[39mtoBe([32m'Forbidden: Can only manage leave requests for team 
members'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 236 |[39m     })
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should return 400 for invalid status'[39m[33m,[39m 
[36masync[39m () [33m=>[39m {[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:235:26)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should return 400 
for invalid status

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 245 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 248 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Validation failed'[39m)
     [90m 249 |[39m     })
     [90m 250 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:247:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should handle team 
lead notes correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 265 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 266 |[39m
    [31m[1m>[22m[39m[90m 267 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 268 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 269 |[39m         expect[33m.[39mstringContaining([32m'admin_notes = 
$4'[39m)[33m,[39m
     [90m 270 |[39m         expect[33m.[39marrayContaining([[32m'Team lead approved'[39m])[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complet
e/__tests__/api/team-lead/leave-requests.test.ts:267:31)

Test Suites: 1 failed, 1 total
Tests:       13 failed, 1 passed, 14 total
Snapshots:   0 total
Time:        2.104 s
Ran all test suites matching /__tests__\\api\\team-lead\\leave-requests.test.ts/i.

