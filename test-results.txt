
> my-v0-project@0.1.0 test
> jest

npm : FAIL __tests__/debug-teamlead.test.ts
At C:\Users\usama\Dropbox\My PC (Puris)\Downloads\rotacloud-complete\run-tests.ps1:9 
char:19
+     $testOutput = npm test 2>&1 | Out-String
+                   ~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (FAIL __tests__/debug-teamlead.test.ts:String) 
    [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  ΓùÅ Console

    console.log
      Response status: 403

      at Object.log (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacl
oud-complete/__tests__/debug-teamlead.test.ts:70:13)

    console.log
      Response data: { error: 'Forbidden: Only team leads can access this endpoint' }

      at Object.log (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacl
oud-complete/__tests__/debug-teamlead.test.ts:71:13)

    console.log
      mockIsTeamLead calls: []

      at Object.log (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacl
oud-complete/__tests__/debug-teamlead.test.ts:72:13)

    console.log
      mockCreateApiAuthMiddleware calls: []

      at Object.log (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacl
oud-complete/__tests__/debug-teamlead.test.ts:73:13)

  ΓùÅ Debug Team Lead Auth ΓÇ║ should debug the auth flow

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    [0m [90m 74 |[39m     
     [90m 75 |[39m     [90m// Check if mocks were called[39m
    [31m[1m>[22m[39m[90m 76 |[39m     
expect(mockCreateApiAuthMiddleware)[33m.[39mtoHaveBeenCalled()
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 77 |[39m     
     [90m 78 |[39m     [90m// This will help us see what's happening[39m
     [90m 79 |[39m     [36mif[39m (response[33m.[39mstatus [33m===[39m 
[35m403[39m) {[0m

      at Object.toHaveBeenCalled (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Dow
nloads/rotacloud-complete/__tests__/debug-teamlead.test.ts:76:41)

FAIL __tests__/api/team-lead/swap-requests.test.ts
  ΓùÅ Team Lead Swap Requests API ΓÇ║ GET /api/team-lead/shifts/swap-requests ΓÇ║ should 
return swap requests for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 76 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 77 |[39m
    [31m[1m>[22m[39m[90m 78 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 79 |[39m       expect(data[33m.[39mdata)[33m.[39mtoEqual([mockSwapRequest])
     [90m 80 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 81 |[39m         expect[33m.[39mstringContaining([32m'WHERE (r.team_id = $1 
OR t.team_id = $1)'[39m)[33m,[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:78:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ GET /api/team-lead/shifts/swap-requests ΓÇ║ should 
filter by status when provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 90 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m 
[33mGET[39m(request)
     [90m 91 |[39m
    [31m[1m>[22m[39m[90m 92 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 93 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 94 |[39m         expect[33m.[39mstringContaining([32m'AND ss.status = 
$2'[39m)[33m,[39m
     [90m 95 |[39m         [mockTeam[33m.[39mid[33m,[39m [32m'pending'[39m][0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:92:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ GET /api/team-lead/shifts/swap-requests ΓÇ║ should 
return 404 if no team found for team lead

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 115 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 116 |[39m
    [31m[1m>[22m[39m[90m 117 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 118 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'No team 
found for this team lead'[39m)
     [90m 119 |[39m     })
     [90m 120 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:117:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ GET /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should return a specific swap request for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 128 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 129 |[39m
    [31m[1m>[22m[39m[90m 130 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 131 |[39m       expect(data[33m.[39mdata)[33m.[39mtoEqual({ 
[33m...[39mmockSwapRequest[33m,[39m requester_team_id[33m:[39m mockTeam[33m.[39mid 
})
     [90m 132 |[39m     })
     [90m 133 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:130:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ GET /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should return 403 if swap request is not for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: "Forbidden: Can only access swap requests for team members"
    Received: "Forbidden: Only team leads can access this endpoint"

    [0m [90m 140 |[39m
     [90m 141 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
    [31m[1m>[22m[39m[90m 142 |[39m       
expect(data[33m.[39merror)[33m.[39mtoBe([32m'Forbidden: Can only access swap requests 
for team members'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 143 |[39m     })
     [90m 144 |[39m
     [90m 145 |[39m     it([32m'should return 404 if swap request not 
found'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:142:26)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ GET /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should return 404 if swap request not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 150 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 151 |[39m
    [31m[1m>[22m[39m[90m 152 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 153 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Swap request 
not found'[39m)
     [90m 154 |[39m     })
     [90m 155 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:152:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ PATCH /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should approve a pending swap request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 169 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 170 |[39m
    [31m[1m>[22m[39m[90m 171 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 172 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Swap 
request approved successfully'[39m)
     [90m 173 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 174 |[39m         expect[33m.[39mstringContaining([32m'UPDATE 
shift_swaps'[39m)[33m,[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:171:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ PATCH /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should deny a pending swap request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 190 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 193 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Swap 
request denied successfully'[39m)
     [90m 194 |[39m     })
     [90m 195 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:192:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ PATCH /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should return 400 if trying to approve/deny non-pending request

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 205 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 208 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Can only 
approve/deny pending requests'[39m)
     [90m 209 |[39m     })
     [90m 210 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:207:31)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ PATCH /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should return 403 if swap request is not for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: "Forbidden: Can only manage swap requests for team members"
    Received: "Forbidden: Only team leads can access this endpoint"

    [0m [90m 221 |[39m
     [90m 222 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
    [31m[1m>[22m[39m[90m 223 |[39m       
expect(data[33m.[39merror)[33m.[39mtoBe([32m'Forbidden: Can only manage swap requests 
for team members'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 224 |[39m     })
     [90m 225 |[39m
     [90m 226 |[39m     it([32m'should return 400 for invalid status'[39m[33m,[39m 
[36masync[39m () [33m=>[39m {[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:223:26)

  ΓùÅ Team Lead Swap Requests API ΓÇ║ PATCH /api/team-lead/shifts/swap-requests/[id] ΓÇ║ 
should return 400 for invalid status

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 233 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 234 |[39m
    [31m[1m>[22m[39m[90m 235 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 236 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Validation 
failed'[39m)
     [90m 237 |[39m     })
     [90m 238 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/swap-requests.test.ts:235:31)

FAIL __tests__/api/team-lead/leave-requests.test.ts
  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should return 
leave requests for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 73 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 74 |[39m
    [31m[1m>[22m[39m[90m 75 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 76 |[39m       
expect(data[33m.[39mdata)[33m.[39mtoEqual([mockLeaveRequest])
     [90m 77 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 78 |[39m         expect[33m.[39mstringContaining([32m'WHERE e.team_id = 
$1'[39m)[33m,[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:75:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should filter 
by status when provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 87 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m 
[33mGET[39m(request)
     [90m 88 |[39m
    [31m[1m>[22m[39m[90m 89 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 90 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 91 |[39m         expect[33m.[39mstringContaining([32m'AND lr.status = 
$2'[39m)[33m,[39m
     [90m 92 |[39m         [mockTeam[33m.[39mid[33m,[39m [32m'pending'[39m][0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:89:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should filter 
by leave type when provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 100 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m 
[33mGET[39m(request)
     [90m 101 |[39m
    [31m[1m>[22m[39m[90m 102 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 103 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 104 |[39m         expect[33m.[39mstringContaining([32m'AND lr.type = 
$2'[39m)[33m,[39m
     [90m 105 |[39m         [mockTeam[33m.[39mid[33m,[39m [32m'vacation'[39m][0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:102:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests ΓÇ║ should return 
404 if no team found for team lead

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 125 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 126 |[39m
    [31m[1m>[22m[39m[90m 127 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 128 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'No team 
found for this team lead'[39m)
     [90m 129 |[39m     })
     [90m 130 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:127:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests/[id] ΓÇ║ should 
return a specific leave request for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 138 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 139 |[39m
    [31m[1m>[22m[39m[90m 140 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 141 |[39m       expect(data[33m.[39mdata)[33m.[39mtoEqual(mockLeaveRequest)
     [90m 142 |[39m     })
     [90m 143 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:140:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests/[id] ΓÇ║ should 
return 403 if leave request is not for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: "Forbidden: Can only access leave requests for team members"
    Received: "Forbidden: Only team leads can access this endpoint"

    [0m [90m 150 |[39m
     [90m 151 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
    [31m[1m>[22m[39m[90m 152 |[39m       
expect(data[33m.[39merror)[33m.[39mtoBe([32m'Forbidden: Can only access leave 
requests for team members'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 153 |[39m     })
     [90m 154 |[39m
     [90m 155 |[39m     it([32m'should return 404 if leave request not 
found'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:152:26)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ GET /api/team-lead/leave-requests/[id] ΓÇ║ should 
return 404 if leave request not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 160 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 161 |[39m
    [31m[1m>[22m[39m[90m 162 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 163 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Leave 
request not found'[39m)
     [90m 164 |[39m     })
     [90m 165 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:162:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should 
approve a pending leave request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 179 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 180 |[39m
    [31m[1m>[22m[39m[90m 181 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 182 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Leave 
request approved successfully'[39m)
     [90m 183 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 184 |[39m         expect[33m.[39mstringContaining([32m'UPDATE 
leave_requests SET status = $1'[39m)[33m,[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:181:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should 
reject a pending leave request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 200 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 201 |[39m
    [31m[1m>[22m[39m[90m 202 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 203 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Leave 
request rejected successfully'[39m)
     [90m 204 |[39m     })
     [90m 205 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:202:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should 
return 400 if trying to approve/reject non-pending request

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 215 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 216 |[39m
    [31m[1m>[22m[39m[90m 217 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 218 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Can only 
approve/reject pending requests'[39m)
     [90m 219 |[39m     })
     [90m 220 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:217:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should 
return 403 if leave request is not for team lead's team

    expect(received).toBe(expected) // Object.is equality

    Expected: "Forbidden: Can only manage leave requests for team members"
    Received: "Forbidden: Only team leads can access this endpoint"

    [0m [90m 231 |[39m
     [90m 232 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
    [31m[1m>[22m[39m[90m 233 |[39m       
expect(data[33m.[39merror)[33m.[39mtoBe([32m'Forbidden: Can only manage leave 
requests for team members'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 234 |[39m     })
     [90m 235 |[39m
     [90m 236 |[39m     it([32m'should return 400 for invalid status'[39m[33m,[39m 
[36masync[39m () [33m=>[39m {[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:233:26)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should 
return 400 for invalid status

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 243 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 244 |[39m
    [31m[1m>[22m[39m[90m 245 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 246 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Validation 
failed'[39m)
     [90m 247 |[39m     })
     [90m 248 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:245:31)

  ΓùÅ Team Lead Leave Requests API ΓÇ║ PATCH /api/team-lead/leave-requests/[id] ΓÇ║ should 
handle team lead notes correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 263 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 264 |[39m
    [31m[1m>[22m[39m[90m 265 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 266 |[39m       expect(mockQuery)[33m.[39mtoHaveBeenCalledWith(
     [90m 267 |[39m         expect[33m.[39mstringContaining([32m'admin_notes = 
$4'[39m)[33m,[39m
     [90m 268 |[39m         expect[33m.[39marrayContaining([[32m'Team lead 
approved'[39m])[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/leave-requests.test.ts:265:31)

FAIL __tests__/api/employees.test.ts
  ΓùÅ Console

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\employees\route.ts:46:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\employees.test.ts:76:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at GET (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/employees/route.ts:46:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/employees.test.ts:76:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\employees\route.ts:46:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\employees.test.ts:76:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at GET (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/employees/route.ts:46:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/employees.test.ts:76:15)

  ΓùÅ /api/employees GET (tenant-aware) ΓÇ║ returns tenant-filtered employees with 
pagination

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 77 |[39m 		[36mconst[39m data [33m=[39m [36mawait[39m 
res[33m.[39mjson()
     [90m 78 |[39m
    [31m[1m>[22m[39m[90m 79 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 80 |[39m 		expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 81 |[39m 		expect([33mArray[39m[33m.[39misArray(data[33m.[39mdata))[33m.
[39mtoBe([36mtrue[39m)
     [90m 82 |[39m 		expect(data[33m.[39mdata)[33m.[39mtoHaveLength([35m1[39m)[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/employees.test.ts:79:22)

FAIL __tests__/api/shifts.assignments.test.ts
  ΓùÅ Console

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\assignments\route.ts:31:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.assignments.test.ts:35:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at GET (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-com
plete/app/api/shifts/assignments/route.ts:31:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.assignments.test.ts:35:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\assignments\route.ts:31:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.assignments.test.ts:35:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at GET (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-com
plete/app/api/shifts/assignments/route.ts:31:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.assignments.test.ts:35:15)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\assignments\route.ts:81:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.assignments.test.ts:52:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/shifts/assignments/route.ts:81:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.assignments.test.ts:52:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\assignments\route.ts:81:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.assignments.test.ts:52:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/shifts/assignments/route.ts:81:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.assignments.test.ts:52:15)

  ΓùÅ /api/shifts/assignments (tenant-aware) ΓÇ║ GET passes tenant_id to helper

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"end_date": "2024-01-07", "start_date": "2024-01-01", "tenant_id": "t1"}

    Number of calls: 0

    [0m [90m 35 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
[33mGET[39m(req)
     [90m 36 |[39m 		[36mawait[39m res[33m.[39mjson()
    [31m[1m>[22m[39m[90m 37 |[39m 		
expect(mockGetShiftAssignments)[33m.[39mtoHaveBeenCalledWith({ start_date[33m:[39m 
[32m'2024-01-01'[39m[33m,[39m end_date[33m:[39m [32m'2024-01-07'[39m[33m,[39m 
tenant_id[33m:[39m [32m't1'[39m })
     [90m    |[39m 		                                [31m[1m^[22m[39m
     [90m 38 |[39m 	})
     [90m 39 |[39m
     [90m 40 |[39m 	it([32m'POST validates employees/shifts in tenant and inserts with 
tenant fields'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toHaveBeenCalledWith (C:\Users\usama\Dropbox\My PC (Puris)../../../../../..
/Downloads/rotacloud-complete/__tests__/api/shifts.assignments.test.ts:37:35)

  ΓùÅ /api/shifts/assignments (tenant-aware) ΓÇ║ POST validates employees/shifts in tenant 
and inserts with tenant fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 403

    [0m [90m 52 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
[33mPOST[39m(req)
     [90m 53 |[39m 		[36mconst[39m json [33m=[39m [36mawait[39m 
res[33m.[39mjson()
    [31m[1m>[22m[39m[90m 54 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 55 |[39m 		
expect(json[33m.[39mdata[33m.[39mid)[33m.[39mtoBe([32m'new-assignment'[39m)
     [90m 56 |[39m 	})
     [90m 57 |[39m })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/shifts.assignments.test.ts:54:22)

PASS __tests__/impersonation.test.ts
PASS __tests__/debug-mock.test.ts
FAIL __tests__/api/shifts.id.test.ts
  ΓùÅ Console

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\[id]\route.ts:21:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.id.test.ts:33:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at GET (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/shifts/[id]/route.ts:21:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.id.test.ts:33:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\[id]\route.ts:21:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.id.test.ts:33:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at GET (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/shifts/[id]/route.ts:21:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.id.test.ts:33:15)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\[id]\route.ts:142:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.id.test.ts:44:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/shifts/[id]/route.ts:142:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.id.test.ts:44:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\[id]\route.ts:142:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.id.test.ts:44:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/shifts/[id]/route.ts:142:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.id.test.ts:44:15)

  ΓùÅ /api/shifts/[id] tenant enforcement ΓÇ║ GET filters by tenant_id

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 32 |[39m 		[36mconst[39m req [33m=[39m [36mnew[39m 
[33mNextRequest[39m([32m'http://localhost:3000/api/shifts/s1'[39m)
     [90m 33 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
getShift(req[33m,[39m { params[33m:[39m [33mPromise[39m[33m.[39mresolve({ 
id[33m:[39m [32m's1'[39m }) })
    [31m[1m>[22m[39m[90m 34 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 35 |[39m 		[36mconst[39m data [33m=[39m [36mawait[39m 
res[33m.[39mjson()
     [90m 36 |[39m 		
expect(data[33m.[39mshift[33m.[39mid)[33m.[39mtoBe([32m's1'[39m)
     [90m 37 |[39m 	})[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/shifts.id.test.ts:34:22)

  ΓùÅ /api/shifts/[id] tenant enforcement ΓÇ║ DELETE enforces tenant and checks assignments

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 43 |[39m 		[36mconst[39m req [33m=[39m [36mnew[39m 
[33mNextRequest[39m([32m'http://localhost:3000/api/shifts/s1'[39m)
     [90m 44 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
deleteShift(req[33m,[39m { params[33m:[39m [33mPromise[39m[33m.[39mresolve({ 
id[33m:[39m [32m's1'[39m }) })
    [31m[1m>[22m[39m[90m 45 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 46 |[39m 	})
     [90m 47 |[39m })
     [90m 48 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/shifts.id.test.ts:45:22)

FAIL __tests__/api/shifts.swap-requests.test.ts
  ΓùÅ Console

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\swap-requests\route.ts:28:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.swap-requests.test.ts:36:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at GET (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-com
plete/app/api/shifts/swap-requests/route.ts:28:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.swap-requests.test.ts:36:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\shifts\swap-requests\route.ts:28:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\shifts.swap-requests.test.ts:36:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at GET (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-com
plete/app/api/shifts/swap-requests/route.ts:28:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/shifts.swap-requests.test.ts:36:15)

  ΓùÅ /api/shifts/swap-requests GET (tenant-aware) ΓÇ║ returns swaps filtered by tenant

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 37 |[39m 		[36mconst[39m json [33m=[39m [36mawait[39m 
res[33m.[39mjson()
     [90m 38 |[39m
    [31m[1m>[22m[39m[90m 39 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 40 |[39m 		expect(json[33m.[39mdata)[33m.[39mtoHaveLength([35m1[39m)
     [90m 41 |[39m 		expect(mockGetShiftSwaps)[33m.[39mtoHaveBeenCalledWith({ 
tenant_id[33m:[39m [32m't1'[39m })
     [90m 42 |[39m 	})[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/shifts.swap-requests.test.ts:39:22)

PASS __tests__/simple.test.ts
FAIL __tests__/api/team-lead/members.test.ts
  ΓùÅ Console

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:16:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:82:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/api-auth.ts:32:19
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/team-lead/teams/[id]/members/route.ts:16:39)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:82:24)

    console.error
      POST /api/team-lead/teams/[id]/members error: Error: The server does not support SSL 
connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:16:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:82:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-c
omplete/app/api/team-lead/teams/[id]/members/route.ts:61:13)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:82:24)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:16:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:150:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/api-auth.ts:32:19
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/team-lead/teams/[id]/members/route.ts:16:39)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:150:24)

    console.error
      POST /api/team-lead/teams/[id]/members error: Error: The server does not support SSL 
connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:16:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:150:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-c
omplete/app/api/team-lead/teams/[id]/members/route.ts:61:13)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:150:24)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:16:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:174:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/api-auth.ts:32:19
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/team-lead/teams/[id]/members/route.ts:16:39)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:174:24)

    console.error
      POST /api/team-lead/teams/[id]/members error: Error: The server does not support SSL 
connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:16:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:174:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-c
omplete/app/api/team-lead/teams/[id]/members/route.ts:61:13)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:174:24)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:72:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:202:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/api-auth.ts:32:19
      at DELETE (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-
complete/app/api/team-lead/teams/[id]/members/route.ts:72:39)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:202:24)

    console.error
      DELETE /api/team-lead/teams/[id]/members error: Error: The server does not support 
SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:72:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:202:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-c
omplete/app/api/team-lead/teams/[id]/members/route.ts:111:13)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:202:24)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:72:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:222:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/api-auth.ts:32:19
      at DELETE (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-
complete/app/api/team-lead/teams/[id]/members/route.ts:72:39)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:222:24)

    console.error
      DELETE /api/team-lead/teams/[id]/members error: Error: The server does not support 
SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\api-auth.ts:32:19
          at DELETE (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\team-lead\teams\[id]\members\route.ts:72:39)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\team-lead\members.test.ts:222:24)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-c
omplete/app/api/team-lead/teams/[id]/members/route.ts:111:13)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/team-lead/members.test.ts:222:24)

  ΓùÅ /api/team-lead/teams/[id]/members ΓÇ║ POST - Add Member ΓÇ║ should add member to 
team successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

    [0m [90m 84 |[39m
     [90m 85 |[39m       [90m// Assertions[39m
    [31m[1m>[22m[39m[90m 86 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 87 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 88 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Employee 
added to team successfully'[39m)
     [90m 89 |[39m       
expect(mockGetTeamByLead)[33m.[39mtoHaveBeenCalledWith([32m'test-tl-id'[39m)[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/members.test.ts:86:31)

  ΓùÅ /api/team-lead/teams/[id]/members ΓÇ║ POST - Add Member ΓÇ║ should reject adding 
member to wrong team

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 500

    [0m [90m 151 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 152 |[39m
    [31m[1m>[22m[39m[90m 153 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 154 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Forbidden: 
team not in your domain'[39m)
     [90m 155 |[39m     })
     [90m 156 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/members.test.ts:153:31)

  ΓùÅ /api/team-lead/teams/[id]/members ΓÇ║ POST - Add Member ΓÇ║ should reject invalid 
employee ID

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 500

    [0m [90m 175 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 176 |[39m
    [31m[1m>[22m[39m[90m 177 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 178 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'Employee not 
found or inactive'[39m)
     [90m 179 |[39m     })
     [90m 180 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/members.test.ts:177:31)

  ΓùÅ /api/team-lead/teams/[id]/members ΓÇ║ DELETE - Remove Member ΓÇ║ should remove 
member from team successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 203 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 204 |[39m
    [31m[1m>[22m[39m[90m 205 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 206 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 207 |[39m       expect(data[33m.[39mmessage)[33m.[39mtoBe([32m'Employee 
removed from team successfully'[39m)
     [90m 208 |[39m       expect(mockRemoveEmployeeFromTeam)[33m.[39mtoHaveBeenCalledWi
th([32m'test-team-id'[39m[33m,[39m [32m'test-employee-id'[39m)[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/members.test.ts:205:31)

  ΓùÅ /api/team-lead/teams/[id]/members ΓÇ║ DELETE - Remove Member ΓÇ║ should reject when 
memberId is missing

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

    [0m [90m 223 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m 
response[33m.[39mjson()
     [90m 224 |[39m
    [31m[1m>[22m[39m[90m 225 |[39m       
expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 226 |[39m       expect(data[33m.[39merror)[33m.[39mtoBe([32m'memberId 
parameter is required'[39m)
     [90m 227 |[39m     })
     [90m 228 |[39m   })[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/team-lead/members.test.ts:225:31)

FAIL __tests__/api/time.clock.test.ts
  ΓùÅ Console

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\time\clock-in\route.ts:15:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\time.clock.test.ts:43:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at POST (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/time/clock-in/route.ts:15:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/time.clock.test.ts:43:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\time\clock-in\route.ts:15:27)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\time.clock.test.ts:43:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at POST (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/time/clock-in/route.ts:15:27)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/time.clock.test.ts:43:15)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\time\clock-out\route.ts:25:25)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\time.clock.test.ts:60:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/time/clock-out/route.ts:25:25)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/time.clock.test.ts:60:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\time\clock-out\route.ts:25:25)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\time.clock.test.ts:60:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/time/clock-out/route.ts:25:25)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/time.clock.test.ts:60:15)

  ΓùÅ time clock-in/out tenant isolation ΓÇ║ clock-in uses tenant_id when fetching 
assignments

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"employee_id": "u1", "end_date": Any<String>, "start_date": Any<String>, 
"tenant_id": "t1"}

    Number of calls: 0

    [0m [90m 43 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m clockIn(req)
     [90m 44 |[39m 		[36mawait[39m res[33m.[39mjson()
    [31m[1m>[22m[39m[90m 45 |[39m 		
expect(mockGetShiftAssignments)[33m.[39mtoHaveBeenCalledWith({ start_date[33m:[39m 
expect[33m.[39many([33mString[39m)[33m,[39m end_date[33m:[39m 
expect[33m.[39many([33mString[39m)[33m,[39m employee_id[33m:[39m 
[32m'u1'[39m[33m,[39m tenant_id[33m:[39m [32m't1'[39m })
     [90m    |[39m 		                                [31m[1m^[22m[39m
     [90m 46 |[39m 	})
     [90m 47 |[39m
     [90m 48 |[39m 	it([32m'clock-out scopes shift lookup and update to 
tenant'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toHaveBeenCalledWith (C:\Users\usama\Dropbox\My PC (Puris)../../../../../..
/Downloads/rotacloud-complete/__tests__/api/time.clock.test.ts:45:35)

  ΓùÅ time clock-in/out tenant isolation ΓÇ║ clock-out scopes shift lookup and update to 
tenant

    expect(received).toContain(expected) // indexOf

    Expected value: 403
    Received array: [200, 201]

    [0m [90m 59 |[39m 		})
     [90m 60 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m clockOut(req)
    [31m[1m>[22m[39m[90m 61 |[39m 		expect([[35m200[39m[33m,[39m 
[35m201[39m])[33m.[39mtoContain(res[33m.[39mstatus)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 62 |[39m 	})
     [90m 63 |[39m })
     [90m 64 |[39m[0m

      at Object.toContain (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/
rotacloud-complete/__tests__/api/time.clock.test.ts:61:22)

FAIL __tests__/api/admin.teams.test.ts
  ΓùÅ Console

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\route.ts:13:18)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:36:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at GET (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/admin/teams/route.ts:13:18)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:36:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\route.ts:13:18)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:36:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at GET (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/admin/teams/route.ts:13:18)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:36:15)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\route.ts:62:18)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:52:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at POST (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/admin/teams/route.ts:62:18)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:52:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\route.ts:62:18)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:52:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at POST (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/app/api/admin/teams/route.ts:62:18)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:52:15)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\[id]\members\route.ts:22:20)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:61:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at GET (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-com
plete/app/api/admin/teams/[id]/members/route.ts:22:20)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:61:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at GET (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\[id]\members\route.ts:22:20)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:61:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at GET (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-com
plete/app/api/admin/teams/[id]/members/route.ts:22:20)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:61:15)

    console.error
      Database query error: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\[id]\members\route.ts:52:20)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:77:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/database.ts:48:13)
      at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:14:20)
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/admin/teams/[id]/members/route.ts:52:20)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:77:15)

    console.error
      Error getting tenant context: Error: The server does not support SSL connections
          at C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at query (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\database.ts:37:14)
          at getTenantContext (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\lib\tenant-middleware.ts:14:20)
          at POST (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\app\api\admin\teams\[id]\members\route.ts:52:20)
          at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)\Downloads\rotacloud-complete\__tests__\api\admin.teams.test.ts:77:15)

    [0m [90m 113 |[39m       [36mreturn[39m
     [90m 114 |[39m     }
    [31m[1m>[22m[39m[90m 115 |[39m     
originalConsoleError[33m.[39mcall(console[33m,[39m [33m...[39margs)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 116 |[39m   }
     [90m 117 |[39m   
     [90m 118 |[39m   console[33m.[39mwarn [33m=[39m ([33m...[39margs[33m:[39m 
any[]) [33m=>[39m {[0m

      at console.call [as error] (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/__tests__/setup.ts:115:26)
      at error (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/lib/tenant-middleware.ts:35:13)
      at POST (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-co
mplete/app/api/admin/teams/[id]/members/route.ts:52:20)
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Download
s/rotacloud-complete/__tests__/api/admin.teams.test.ts:77:15)

  ΓùÅ admin/teams tenant scoping ΓÇ║ GET /admin/teams filters by tenant_id

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 35 |[39m 		[36mconst[39m req [33m=[39m [36mnew[39m 
[33mNextRequest[39m([32m'http://localhost:3000/api/admin/teams'[39m)
     [90m 36 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
[33mTEAMS_GET[39m(req)
    [31m[1m>[22m[39m[90m 37 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 38 |[39m 		expect(mockQuery[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0
[39m])[33m.[39mtoContain([32m't.tenant_id = $1'[39m)
     [90m 39 |[39m 	})
     [90m 40 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/admin.teams.test.ts:37:22)

  ΓùÅ admin/teams tenant scoping ΓÇ║ POST /admin/teams inserts with tenant_id and org

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 403

    [0m [90m 51 |[39m 		})
     [90m 52 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
[33mTEAMS_POST[39m(req)
    [31m[1m>[22m[39m[90m 53 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 54 |[39m 		[36mconst[39m insertCall [33m=[39m 
mockQuery[33m.[39mmock[33m.[39mcalls[33m.[39mfind(([sql]) [33m=>[39m (sql 
[36mas[39m string)[33m.[39mincludes([32m'INSERT INTO teams'[39m))
     [90m 55 |[39m 		expect(insertCall[33m?[39m[33m.[39m[[35m0[39m])[33m.[39mtoCo
ntain([32m'tenant_id'[39m)
     [90m 56 |[39m 	})[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/admin.teams.test.ts:53:22)

  ΓùÅ admin/teams tenant scoping ΓÇ║ GET /admin/teams/[id]/members filters by tenant_id

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 60 |[39m 		[36mconst[39m req [33m=[39m [36mnew[39m 
[33mNextRequest[39m([32m'http://localhost:3000/api/admin/teams/X/members'[39m)
     [90m 61 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
[33mMEMBERS_GET[39m(req[33m,[39m { params[33m:[39m { id[33m:[39m [32m'X'[39m } })
    [31m[1m>[22m[39m[90m 62 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 63 |[39m 		expect(mockQuery[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0
[39m])[33m.[39mtoContain([32m'e.tenant_id = $2'[39m)
     [90m 64 |[39m 	})
     [90m 65 |[39m[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/admin.teams.test.ts:62:22)

  ΓùÅ admin/teams tenant scoping ΓÇ║ POST /admin/teams/[id]/members updates member with 
tenant guard

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 76 |[39m 		})
     [90m 77 |[39m 		[36mconst[39m res [33m=[39m [36mawait[39m 
[33mMEMBERS_POST[39m(req[33m,[39m { params[33m:[39m { id[33m:[39m [32m'X'[39m } 
})
    [31m[1m>[22m[39m[90m 78 |[39m 		
expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m 		                   [31m[1m^[22m[39m
     [90m 79 |[39m 		[36mconst[39m updateCall [33m=[39m 
mockQuery[33m.[39mmock[33m.[39mcalls[33m.[39mfind(([sql]) [33m=>[39m (sql 
[36mas[39m string)[33m.[39mstartsWith([32m'UPDATE employees'[39m))
     [90m 80 |[39m 		
expect(updateCall[33m?[39m[33m.[39m[[35m0[39m])[33m.[39mtoContain([32m'tenant_id 
= $3'[39m)
     [90m 81 |[39m 	})[0m

      at Object.toBe (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotac
loud-complete/__tests__/api/admin.teams.test.ts:78:22)

FAIL __tests__/setup.ts
  ΓùÅ Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotaclou
d-complete/node_modules/@jest/core/build/TestScheduler.js:133:18)
      at C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complete
/node_modules/@jest/core/build/TestScheduler.js:254:19
      at C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rot
acloud-complete/node_modules/emittery/index.js:361:23)

FAIL tests/scheduling.spec.ts
  ΓùÅ Test suite failed to run

    Playwright Test needs to be invoked via 'npx playwright test' and excluded from Jest 
test runs.
    Creating one directory for Playwright tests and one for Jest is the recommended way of 
doing it.
    See https://playwright.dev/docs/intro for more information about Playwright Test.

    [0m [90m 1 |[39m [36mimport[39m { test[33m,[39m expect } [36mfrom[39m 
[32m'@playwright/test'[39m
     [90m 2 |[39m
    [31m[1m>[22m[39m[90m 3 |[39m test([32m'admin can create template and 
assign/edit shift in scheduling'[39m[33m,[39m [36masync[39m ({ page }) [33m=>[39m {
     [90m   |[39m     [31m[1m^[22m[39m
     [90m 4 |[39m   [36mawait[39m page[33m.[39mgoto([32m'/admin/scheduling'[39m)
     [90m 5 |[39m   [90m// Simulate stored admin session if needed[39m
     [90m 6 |[39m   [36mawait[39m page[33m.[39mevaluate(() [33m=>[39m {[0m

      at throwIfRunningInsideJest (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Do
wnloads/rotacloud-complete/node_modules/playwright/lib/common/testType.js:272:11)
      at TestTypeImpl._createTest (C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Do
wnloads/rotacloud-complete/node_modules/playwright/lib/common/testType.js:86:5)
      at C:\Users\usama\Dropbox\My PC (Puris)../../../../../../Downloads/rotacloud-complete
/node_modules/playwright/lib/transform/transform.js:275:12
      at Object.<anonymous> (C:\Users\usama\Dropbox\My PC 
(Puris)../../../../../../Downloads/rotacloud-complete/tests/scheduling.spec.ts:3:5)

Test Suites: 12 failed, 3 passed, 15 total
Tests:       42 failed, 20 passed, 62 total
Snapshots:   0 total
Time:        9.061 s
Ran all test suites.

